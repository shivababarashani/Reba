2025-05-14 15:31:26,274 - INFO - Starting Gradio UI.
2025-05-14 15:31:26,658 - INFO - HTTP Request: GET http://127.0.0.1:7861/gradio_api/startup-events "HTTP/1.1 200 OK"
2025-05-14 15:31:26,674 - INFO - HTTP Request: HEAD http://127.0.0.1:7861/ "HTTP/1.1 200 OK"
2025-05-14 15:31:27,073 - INFO - HTTP Request: GET https://api.gradio.app/pkg-version "HTTP/1.1 200 OK"
2025-05-14 15:31:37,323 - INFO - Starting processing from UI.
2025-05-14 15:31:37,326 - INFO - Loading internal CSV data...
2025-05-14 15:31:37,326 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:31:37,327 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:31:37,327 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:31:37,327 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:31:37,327 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:31:37,327 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:31:53,432 - INFO - Starting processing from UI.
2025-05-14 15:31:53,432 - INFO - Loading internal CSV data...
2025-05-14 15:31:53,433 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:31:53,433 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:31:53,433 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:31:53,434 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:31:53,434 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:31:53,434 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:32:44,558 - INFO - Starting processing from UI.
2025-05-14 15:32:44,559 - INFO - Loading internal CSV data...
2025-05-14 15:32:44,560 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:32:44,560 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:32:44,560 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:32:44,560 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:32:44,560 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:32:44,560 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:32:53,297 - INFO - Starting processing from UI.
2025-05-14 15:32:53,298 - INFO - Loading internal CSV data...
2025-05-14 15:32:53,298 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:32:53,298 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:32:53,299 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:32:53,299 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:32:53,299 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:32:53,299 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:32:53,299 - ERROR - Een onverwachte fout trad op tijdens de verwerking: name 'is_valid_rebate_request' is not defined
Traceback (most recent call last):
  File "C:\Users\j.lucvanderheijden\PycharmProjects\RebateAgent\ui_test.py", line 254, in process_email_for_ui
    is_rebate_request = is_valid_rebate_request(email_object)
                        ^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'is_valid_rebate_request' is not defined

2025-05-14 15:34:47,364 - INFO - Starting Gradio UI.
2025-05-14 15:34:47,728 - INFO - HTTP Request: GET http://127.0.0.1:7861/gradio_api/startup-events "HTTP/1.1 200 OK"
2025-05-14 15:34:47,745 - INFO - HTTP Request: HEAD http://127.0.0.1:7861/ "HTTP/1.1 200 OK"
2025-05-14 15:34:48,151 - INFO - HTTP Request: GET https://api.gradio.app/pkg-version "HTTP/1.1 200 OK"
2025-05-14 15:35:43,314 - INFO - Starting processing from UI.
2025-05-14 15:35:43,315 - INFO - Loading internal CSV data...
2025-05-14 15:35:43,316 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:35:43,316 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:35:43,316 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:35:43,317 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:35:43,317 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:35:43,317 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:35:46,765 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-14 15:35:46,767 - INFO - LLM Response to the question if it's a valid rebate request: No, this email is not a rebate request. Confidence score: 0.9.

The email does mention a "rebate" and an action period (Black Friday), but it describes a scenario where the company is expected to pay the vendor ("Jij geeft ons 3000 euro voor elke unit die je nu op voorraad hebt"), rather than the vendor offering a discount to the company. This does not fit the definition of a sell-out rebate where the vendor provides a discount to the company based on sales during a specific period.
2025-05-14 15:35:46,767 - INFO - LLM determined email is not a rebate request.
2025-05-14 15:36:16,551 - INFO - Starting processing from UI.
2025-05-14 15:36:16,552 - INFO - Loading internal CSV data...
2025-05-14 15:36:16,553 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:36:16,553 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:36:16,554 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:36:16,554 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:36:16,554 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:36:16,554 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:36:18,462 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-14 15:36:18,469 - INFO - LLM Response to the question if it's a valid rebate request: Yes, this email is a rebate request. Confidence score: 0.9. 

The email is from a vendor to the company, offering a discount on iPhones during a specific action period (Black Friday). It mentions a specific product and time period, which aligns with the definition of a sell-out rebate request.
2025-05-14 15:36:18,469 - INFO - LLM determined the email is a rebate request.
2025-05-14 15:36:18,470 - INFO - Extracted confidence: 0.9
2025-05-14 15:36:18,470 - INFO - Email is a valid rebate request with confidence 0.9.
2025-05-14 15:36:18,471 - INFO - Returning True from is_valid_rebate_request
2025-05-14 15:36:18,471 - INFO - Email is known rebate request. Proceeding with extraction and validation.
2025-05-14 15:36:18,471 - INFO - Extracting rebate data...
2025-05-14 15:36:20,227 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-14 15:36:20,229 - INFO - LLM Raw Extraction Response: {
  "rebate_items": [
    {
      "manufacturer_product_code": "dfghal908",
      "product_id": null,
      "product_name": "Iphone",
      "subsidiary": "NL",
      "start_date": "2024-11-20",
      "end_date": "2024-11-29",
      "campaign_promotion_related": true,
      "rebate_compensation_factor": 50.0,
      "max_spq": 100
    },
    {
      "manufacturer_product_code": "dfghal908",
      "product_id": null,
      "product_name": "Iphone",
      "subsidiary": "BE",
      "start_date": "2024-11-20",
      "end_date": "2024-11-29",
      "campaign_promotion_related": true,
      "rebate_compensation_factor": 50.0,
      "max_spq": 100
    }
  ]
}
2025-05-14 15:36:20,229 - INFO - Successfully parsed raw JSON from LLM.
2025-05-14 15:36:20,230 - INFO - Extracted 2 rebate items.
2025-05-14 15:36:20,230 - INFO - Transforming extracted data...
2025-05-14 15:36:20,230 - INFO - Attempting to transforming the data.
2025-05-14 15:36:20,230 - INFO - Finished data transformation. Transformed 2 items.
2025-05-14 15:36:20,230 - INFO - Aantal geëxtraheerde items: 2
2025-05-14 15:36:20,230 - INFO - Validating extracted data...
2025-05-14 15:36:20,231 - INFO - Item 0: All required fields found and validated.
2025-05-14 15:36:20,232 - INFO - Item 1: All required fields found and validated.
2025-05-14 15:36:20,232 - INFO - Evaluating desirability...
2025-05-14 15:36:20,232 - INFO - Starting rebate desirability evaluation (by MPC and Subsidiary).
2025-05-14 15:36:20,232 - WARNING - Internal data row 1: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': '12345abcdef', 'product_id': '1234', 'subsidiary': 'NL', 'demand_forecast': '1.2', 'current_npp': '30', 'compensation_required': '2'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 2: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': '12345abcdef', 'product_id': '1234', 'subsidiary': 'BE', 'demand_forecast': '6', 'current_npp': '30', 'compensation_required': '3'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 3: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': '12345abcdef', 'product_id': '1234', 'subsidiary': 'DE', 'demand_forecast': '4', 'current_npp': '30', 'compensation_required': '2'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 4: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'dfghal908', 'product_id': '456', 'subsidiary': 'NL', 'demand_forecast': '3', 'current_npp': '20', 'compensation_required': '4'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 5: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'dfghal908', 'product_id': '456', 'subsidiary': 'BE', 'demand_forecast': '2', 'current_npp': '20', 'compensation_required': '51'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 6: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'dfghal908', 'product_id': '456', 'subsidiary': 'DE', 'demand_forecast': '1', 'current_npp': '20', 'compensation_required': '0'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 7: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'zxva234', 'product_id': '789', 'subsidiary': 'NL', 'demand_forecast': '6', 'current_npp': '40', 'compensation_required': '1'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 8: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'zxva234', 'product_id': '789', 'subsidiary': 'BE', 'demand_forecast': '5', 'current_npp': '40', 'compensation_required': '2'}
2025-05-14 15:36:20,232 - WARNING - Internal data row 9: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'zxva234', 'product_id': '789', 'subsidiary': 'DE', 'demand_forecast': '4', 'current_npp': '40', 'compensation_required': '1'}
2025-05-14 15:36:20,232 - INFO - Built internal lookup with 0 entries based on (MPC, Subsidiary).
2025-05-14 15:36:20,232 - WARNING - Item 0: Combination (MPC='dfghal908', Subsidiary='NL') not found in internal data lookup.
2025-05-14 15:36:20,232 - WARNING - Item 1: Combination (MPC='dfghal908', Subsidiary='BE') not found in internal data lookup.
2025-05-14 15:36:20,233 - INFO - Rebate desirability evaluation finished.
2025-05-14 15:36:20,233 - INFO - UI processing complete.
2025-05-14 15:38:11,514 - INFO - Starting processing from UI.
2025-05-14 15:38:11,516 - INFO - Loading internal CSV data...
2025-05-14 15:38:11,517 - INFO - Successfully loaded 2 unique values from the 'column 2' column in this CSV: Mock Data Rebate Agent - Vendors.csv.
2025-05-14 15:38:11,517 - INFO - Successfully loaded 3 unique values from the 'column 0' column in this CSV: Mock Data Rebate Agent - Manufacturer Product Code Data.csv.
2025-05-14 15:38:11,517 - INFO - Successfully loaded 9 rows from CSV: Mock Data Rebate Agent - Internal Data.csv.
2025-05-14 15:38:11,518 - INFO - Loaded 2 known vendor emails.
2025-05-14 15:38:11,518 - INFO - Loaded 3 valid MPCs.
2025-05-14 15:38:11,518 - INFO - Loaded 9 rows from full internal data.
2025-05-14 15:38:13,635 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-14 15:38:13,636 - INFO - LLM Response to the question if it's a valid rebate request: Yes, confidence score: 0.9. 

The email appears to be a rebate request as it offers a discount ("50 euro korting") on a specific product (Iphones) during a specific action period (Black Friday). The proposal is sent from the vendor to the recipient, which aligns with the definition provided.
2025-05-14 15:38:13,636 - INFO - LLM determined the email is a rebate request.
2025-05-14 15:38:13,636 - INFO - Extracted confidence: 0.9
2025-05-14 15:38:13,636 - INFO - Email is a valid rebate request with confidence 0.9.
2025-05-14 15:38:13,636 - INFO - Returning True from is_valid_rebate_request
2025-05-14 15:38:13,636 - INFO - Email is known rebate request. Proceeding with extraction and validation.
2025-05-14 15:38:13,636 - INFO - Extracting rebate data...
2025-05-14 15:38:15,004 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-05-14 15:38:15,006 - INFO - LLM Raw Extraction Response: {
  "rebate_items": [
    {
      "manufacturer_product_code": "dfghal908",
      "product_id": null,
      "product_name": "Iphone",
      "subsidiary": null,
      "start_date": null,
      "end_date": null,
      "campaign_promotion_related": true,
      "rebate_compensation_factor": 50.0,
      "max_spq": 100
    }
  ]
}
2025-05-14 15:38:15,006 - INFO - Successfully parsed raw JSON from LLM.
2025-05-14 15:38:15,006 - INFO - Extracted 1 rebate items.
2025-05-14 15:38:15,006 - INFO - Transforming extracted data...
2025-05-14 15:38:15,008 - INFO - Attempting to transforming the data.
2025-05-14 15:38:15,008 - INFO - Finished data transformation. Transformed 1 items.
2025-05-14 15:38:15,008 - INFO - Aantal geëxtraheerde items: 1
2025-05-14 15:38:15,008 - INFO - Validating extracted data...
2025-05-14 15:38:15,008 - WARNING - Item 0: Found issues: Field 'start_date' is missing or null., Field 'end_date' is missing or null., Field 'subsidiary' is missing or null.
2025-05-14 15:38:15,008 - INFO - Evaluating desirability...
2025-05-14 15:38:15,008 - INFO - Starting rebate desirability evaluation (by MPC and Subsidiary).
2025-05-14 15:38:15,008 - WARNING - Internal data row 1: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': '12345abcdef', 'product_id': '1234', 'subsidiary': 'NL', 'demand_forecast': '1.2', 'current_npp': '30', 'compensation_required': '2'}
2025-05-14 15:38:15,008 - WARNING - Internal data row 2: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': '12345abcdef', 'product_id': '1234', 'subsidiary': 'BE', 'demand_forecast': '6', 'current_npp': '30', 'compensation_required': '3'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 3: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': '12345abcdef', 'product_id': '1234', 'subsidiary': 'DE', 'demand_forecast': '4', 'current_npp': '30', 'compensation_required': '2'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 4: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'dfghal908', 'product_id': '456', 'subsidiary': 'NL', 'demand_forecast': '3', 'current_npp': '20', 'compensation_required': '4'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 5: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'dfghal908', 'product_id': '456', 'subsidiary': 'BE', 'demand_forecast': '2', 'current_npp': '20', 'compensation_required': '51'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 6: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'dfghal908', 'product_id': '456', 'subsidiary': 'DE', 'demand_forecast': '1', 'current_npp': '20', 'compensation_required': '0'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 7: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'zxva234', 'product_id': '789', 'subsidiary': 'NL', 'demand_forecast': '6', 'current_npp': '40', 'compensation_required': '1'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 8: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'zxva234', 'product_id': '789', 'subsidiary': 'BE', 'demand_forecast': '5', 'current_npp': '40', 'compensation_required': '2'}
2025-05-14 15:38:15,009 - WARNING - Internal data row 9: Skipping due to missing or empty 'Manufacturer Product Code'. Row: {'manufacturer_product_code': 'zxva234', 'product_id': '789', 'subsidiary': 'DE', 'demand_forecast': '4', 'current_npp': '40', 'compensation_required': '1'}
2025-05-14 15:38:15,009 - INFO - Built internal lookup with 0 entries based on (MPC, Subsidiary).
2025-05-14 15:38:15,009 - WARNING - Item 0: Skipping evaluation for MPC 'dfghal908' due to missing or empty 'subsidiary'.
2025-05-14 15:38:15,009 - INFO - Rebate desirability evaluation finished.
2025-05-14 15:38:15,010 - INFO - UI processing complete.
